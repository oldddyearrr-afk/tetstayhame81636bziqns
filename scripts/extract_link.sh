#!/bin/bash

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø« Ù…Ù† ÙÙŠØ³Ø¨ÙˆÙƒ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
NC='\033[0m'

clear
echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo -e "${BLUE}      ğŸ“º Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø« Ù…Ù† ÙÙŠØ³Ø¨ÙˆÙƒ      ${NC}"
echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ yt-dlp
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
if ! command -v yt-dlp &> /dev/null; then
    echo -e "${YELLOW}[!]${NC} yt-dlp ØºÙŠØ± Ù…Ø«Ø¨Øª. Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ«Ø¨ÙŠØª..."
    pip install -U yt-dlp > /dev/null 2>&1
    if [ $? -eq 0 ]; then
        echo -e "${GREEN}[âœ“]${NC} ØªÙ… ØªØ«Ø¨ÙŠØª yt-dlp Ø¨Ù†Ø¬Ø§Ø­"
        echo ""
    else
        echo -e "${RED}[âœ—]${NC} ÙØ´Ù„ ØªØ«Ø¨ÙŠØª yt-dlp"
        exit 1
    fi
fi

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø·Ù„Ø¨ Ù…Ù„Ù Ø§Ù„ÙƒÙˆÙƒÙŠØ²
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo -e "${CYAN}Ø§Ù„Ø®Ø·ÙˆØ© 1/3: Ù…Ù„Ù Ø§Ù„ÙƒÙˆÙƒÙŠØ²${NC}"
echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
echo ""
echo -e "Ù…Ù„Ø§Ø­Ø¸Ø©: Ù…Ù„Ù Ø§Ù„ÙƒÙˆÙƒÙŠØ² Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„Ø¨Ø« Ø§Ù„Ø®Ø§Øµ (Ù„Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ ÙÙ‚Ø·)"
echo ""
echo -e "${BLUE}ÙƒÙŠÙ ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ù…Ù„Ù Ø§Ù„ÙƒÙˆÙƒÙŠØ²ØŸ${NC}"
echo "  1. Ø«Ø¨Øª Ø¥Ø¶Ø§ÙØ© 'Get cookies.txt LOCALLY' Ø¹Ù„Ù‰ Ù…ØªØµÙØ­Ùƒ"
echo "  2. Ø§ÙØªØ­ facebook.com ÙˆØ³Ø¬Ù„ Ø¯Ø®ÙˆÙ„"
echo "  3. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ø®ØªØ± Export"
echo "  4. Ø§Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø¨Ø§Ø³Ù…: cookies.txt"
echo ""

read -p "Ø£Ø¯Ø®Ù„ Ù…Ø³Ø§Ø± Ù…Ù„Ù Ø§Ù„ÙƒÙˆÙƒÙŠØ² (Ù…Ø«Ø§Ù„: cookies.txt): " COOKIE_FILE

if [ -z "$COOKIE_FILE" ]; then
    echo -e "${RED}[âœ—]${NC} Ù„Ù… ØªØ¯Ø®Ù„ Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ù„Ù!"
    exit 1
fi

if [ ! -f "$COOKIE_FILE" ]; then
    echo -e "${RED}[âœ—]${NC} Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯: $COOKIE_FILE"
    echo -e "${YELLOW}ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ù„Ù Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯${NC}"
    exit 1
fi

echo -e "${GREEN}[âœ“]${NC} ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„Ù Ø§Ù„ÙƒÙˆÙƒÙŠØ²"
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø·Ù„Ø¨ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø«
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo -e "${CYAN}Ø§Ù„Ø®Ø·ÙˆØ© 2/3: Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø«${NC}"
echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
echo ""
echo -e "Ù…Ø«Ø§Ù„: https://www.facebook.com/share/v/xxxxx/"
echo ""

read -p "Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø«: " FB_URL

if [ -z "$FB_URL" ]; then
    echo -e "${RED}[âœ—]${NC} Ù„Ù… ØªØ¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø«!"
    exit 1
fi

echo -e "${GREEN}[âœ“]${NC} ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ø§Ø¨Ø·"
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ø§Ù„Ø®Ø·ÙˆØ© 4: Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±Ø§Ø¨Ø·
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo -e "${CYAN}Ø§Ù„Ø®Ø·ÙˆØ© 3/3: Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±Ø§Ø¨Ø·${NC}"
echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
echo ""
echo -e "${BLUE}[â³]${NC} Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬... (Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø¨Ø¶Ø¹ Ø«ÙˆØ§Ù†)"
echo ""

# Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
STREAM_URL=$(yt-dlp --cookies "$COOKIE_FILE" --get-url "$FB_URL" 2>&1 | grep -E "^https" | head -1)

# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†Ø¬Ø§Ø­
if [ -z "$STREAM_URL" ]; then
    echo -e "${RED}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${RED}           âœ— ÙØ´Ù„ Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬              ${NC}"
    echo -e "${RED}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    echo -e "${YELLOW}Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©:${NC}"
    echo "  â€¢ Ø§Ù„Ø¨Ø« ØºÙŠØ± Ù…Ø¨Ø§Ø´Ø± Ø§Ù„Ø¢Ù† (ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† ğŸ”´ LIVE)"
    echo "  â€¢ Ù…Ù„Ù Ø§Ù„ÙƒÙˆÙƒÙŠØ² Ù‚Ø¯ÙŠÙ… Ø£Ùˆ ØºÙŠØ± ØµØ­ÙŠØ­"
    echo "  â€¢ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¨Ø«"
    echo ""
    exit 1
fi

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ø§Ù„Ø®Ø·ÙˆØ© 5: Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ link.json
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TIMESTAMP=$(date +"%Y-%m-%d %H:%M:%S")

cat > link.json << EOF
{
  "extracted_at": "$TIMESTAMP",
  "facebook_url": "$FB_URL",
  "stream_url": "$STREAM_URL",
  "format": "$(echo $STREAM_URL | grep -q 'm3u8' && echo 'M3U8 (HLS)' || echo 'DASH (MPD)')",
  "status": "active"
}
EOF

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo -e "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo -e "${GREEN}         âœ“ ØªÙ… Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¨Ù†Ø¬Ø§Ø­!           ${NC}"
echo -e "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo ""

echo -e "${CYAN}ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø±Ø§Ø¨Ø·:${NC}"
echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
echo ""
echo -e "${BLUE}Ø§Ù„ØµÙŠØºØ©:${NC} $(echo $STREAM_URL | grep -q 'm3u8' && echo 'M3U8 (HLS)' || echo 'DASH (MPD)')"
echo -e "${BLUE}Ø§Ù„ØªØ§Ø±ÙŠØ®:${NC} $TIMESTAMP"
echo ""

echo -e "${CYAN}ğŸ“º Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø±:${NC}"
echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
echo "$STREAM_URL"
echo ""

echo -e "${CYAN}ğŸ’¾ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©:${NC}"
echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
echo -e "${GREEN}[âœ“]${NC} link.json - ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø· ÙƒØ§Ù…Ù„Ø©"
echo ""

echo -e "${CYAN}ğŸš€ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ©:${NC}"
echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
echo "Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø« Ø§Ù„Ø¢Ù† (Ù…Ø¹ stream key):"
echo -e "  ${GREEN}./control.sh start YOUR_STREAM_KEY_HERE${NC}"
echo ""
echo "Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ù† link.json Ù…Ø¨Ø§Ø´Ø±Ø©"
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ø£Ù…Ø§Ù†: Ø­Ø°Ù Ù…Ù„Ù Ø§Ù„ÙƒÙˆÙƒÙŠØ²
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo -e "${RED}âš ï¸  ØªØ­Ø°ÙŠØ± Ø£Ù…Ù†ÙŠ:${NC}"
echo "Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù…Ù„Ù Ø§Ù„ÙƒÙˆÙƒÙŠØ² Ù„Ø­Ù…Ø§ÙŠØ© Ø­Ø³Ø§Ø¨ÙƒØŸ (y/n)"
read -p "Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±: " DELETE_COOKIES

if [[ "$DELETE_COOKIES" =~ ^[Yy]$ ]]; then
    rm -f "$COOKIE_FILE"
    echo -e "${GREEN}[âœ“]${NC} ØªÙ… Ø­Ø°Ù Ù…Ù„Ù Ø§Ù„ÙƒÙˆÙƒÙŠØ²"
else
    echo -e "${YELLOW}[!]${NC} ØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù…Ù„Ù Ø§Ù„ÙƒÙˆÙƒÙŠØ²"
fi

echo ""
echo -e "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo -e "${GREEN}              ØªÙ… Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰               ${NC}"
echo -e "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
